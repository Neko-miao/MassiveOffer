# Computer Network

## Basic
- 五层协议：
    - 应用层（报文）：应用程序，提供网络服务接口；
    - 传输层（报文段/用户数据报）：定义了一些传输协议和端口，常见的协议就是TCP和UDP；
    - 网络层（数据报）：为网络中的两个主机之间提供可用路径
    - 链路层（帧）：定义了如何格式化数据用于传输，以及如何让控制对物理介质的访问，以及错误检测和纠正；
    - 物理层（比特）：主要定义物理设备接口；

## 应用层协议


## 传输层协议
### 三次握手和四次挥手，以及为什么要这样
- 三次握手：
    - 握手开始，客户端是Close状态，而服务端是Listen状态；
    - 第一次握手：客户端发送（SYN=1，seq=x）的报文段，客户端进入SYN_SEND状态；
    - 第二次握手：服务器收到客户端的SYN报文后，发送（SYN=1，seq=y，ack=x+1）的报文，表示收到了客户端的SYN报文，并期望下一次客户端的序列号是seq=x+1，此时服务器处于SYN_REVD的状态；
    - 第三次握手：客户段响应服务器的SYN报文后，发送一个ACK报文，序列号为seq=x+1，确认号为ack=y+1，此时客户端处理Establised状态，服务端收到该报文后也进入Establised状态，双放可以开始通信；
- 为什么要三次握手？
    - 三次握手是为了保证通讯的可靠性，需要通讯双方都确认发送和接受是正常；
    - 第一次握手，客户什么都不知道，服务器确认了对方发送正常，自己接受正常；
    - 第二次握手，客户端确认双方发送和接受正常，服务器确认了自己接受、客户端发送是正常；
    - 第三次握手：客户端确认了双方发送接受都正常，服务器也确认了双方发送和接受是正常；
    - 第三次握手可以携带数据，但是第一次和第二次不要携带，否则可能恶意攻击是第一次握手客户端发送大量SYN请求并携带大量数据，这会让服务器花很多时间和空间来处理这些报文。

- 四次挥手：由TCP的半关闭（half-closed）导致，即TCP一端结束后，它还能接受来自另一端的数据。
    - 第一次挥手：客户端发送FIN报文（FIN=1，seq=u），并停止发送数据，主动关闭TCP连接，此时客户端处于FIN_WAIT1状态；
    - 第二次挥手：服务端收到FIN报文后，发送ACK报文（seq=v，ack=u+1），表明收到了客户端的报文，并进入CLOSE_WAIT状态； 此时的TCP处于半关闭状态，客户端到服务段的连接释放；客户端收到该报文后，进入FIN_WAIT2状态，等待服务端发出的连接释放报文；
    - 第三次挥手：服务端也想断开连接，与客户端向服务段第一次挥手一样，发送FIN报文，服务端处于LAST_ACK
    状态，等待客户端确认。
    - 第四次挥手：客户端收到FIN报文后，一样发送ACK报文作为应答，客户端处于TIME_WAIT状态，等待足够的时间确保TCP远程收到连接中断请求；等待2个MSL后，才会进入CLOSE状态，因为服务端若没有收到客户端的ACK报文，会再次发送FIN报文；服务端收到ACK后关闭连接，进入CLOSE状态，此时客户端等待足够时间后也进入CLOSE状态；

- 为什么需要四次挥手：由TCP的半关闭导致的。

### TCP的拥塞控制
- TCP采用基于窗口的拥塞控制方法，该方法属于闭环控制方法：
    - TCP发送方维护一个拥塞窗口，拥塞窗口根据时机网络拥塞情况调整发送的数据量，
    - 拥塞窗口取决了接收方的窗口值和网络拥塞状况，即“真正的发送窗口值=MIN(接收方窗口值，拥塞窗口值)”  
- 控制拥塞窗口的原则：若网络没有出现拥塞，拥塞窗口就增大一些，以便发送更多分组，否则减少拥塞窗口；
- 拥塞判定：重传定时器超时，收到三个重复的ACK

- 四种拥塞控制算法：
    - 慢开始：用来确定网络负载能力和拥塞程度，由小到大组件增大拥塞窗口数值；
    - 拥塞避免：设置慢开始门限，小于门限值使用慢开始算法，大于门限值使用拥塞控制算法，等于门限值则都可以；一旦发现网络拥塞就把门限值设为拥塞窗口的一半，拥塞窗口大小设为1，然后开始慢启动过程；
    - 快重传：接受方收到失序报文后立即发送重传确认，而不要等待自己发送数据时才进行确认；
    - 快恢复：当发送放连续收到3个ACK确认时，就把门限减半，但是接下来并不执行慢开始算法，而是把拥塞窗口值设置为门限值的一半，然后缓慢增大拥塞窗口；

## 网络层协议

## 链路层协议  

## 物理层协议  